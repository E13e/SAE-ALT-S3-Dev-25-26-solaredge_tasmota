<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT : MQTT</title>
    <script type="text/javascript">
        /*
        const host = "mqtt://mqtt.iut-blagnac.fr"; // URL du broker
        const port = 8883;        // Port du broker
        const clientId = "client_" + Math.random().toString(36).substr(2, 9); // Identifiant unique du client
        const username = "student";
        const password = "student";
        var options = {
            timeout: 3,
            userName: username,
            password: password,
            useSSL: true,
            onSuccess: onConnect,
            onFailure: onFailure,
            protocolId: 'MQTT'
        };
        */

        const mqtt = require("mqtt");
        const client = mqtt.connect("mqtt://mqtt.iut-blagnac.fr");

        client.on("connect", () => {
        client.subscribe("presence", (err) => {
            if (!err) {
            client.publish("presence", "Hello mqtt");
            }
        });
        });

        client.on("message", (topic, message) => {
        // message is Buffer
        console.log(message.toString());
        client.end();
        });
    </script>
</head>

<body onload="MQTTconnect()">
    <h1>Message MQTT</h1>
    <p id="data">Connexion en cours...</p>
</body>
</html>


